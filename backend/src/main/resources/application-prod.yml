# Production Configuration
server:
  port: 8080
  compression:
    enabled: true
    mime-types: text/html,text/xml,text/plain,text/css,application/javascript,application/json
  error:
    include-message: never
    include-stacktrace: never
    whitelabel:
      enabled: false

spring:
  application:
    name: pullwise-api

  # Database
  datasource:
    url: ${DATABASE_URL:jdbc:postgresql://postgres:5432/pullwise}
    username: ${DATABASE_USER:pullwise}
    password: ${DATABASE_PASSWORD}
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
      idle-timeout: 30000
      max-lifetime: 600000
      connection-timeout: 5000

  # JPA
  jpa:
    hibernate:
      ddl-auto: validate
    show-sql: false
    open-in-view: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: false
        jdbc:
          batch_size: 50
          order_inserts: true
          order_updates: true

  # Flyway
  flyway:
    enabled: true
    baseline-on-migrate: true
    locations: classpath:db/migration

  # Redis
  data:
    redis:
      host: ${REDIS_HOST:redis}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}
      timeout: 5000ms
      lettuce:
        pool:
          max-active: 20
          max-idle: 10
          min-idle: 5

  # Artemis/ActiveMQ
  artemis:
    mode: native
    host: ${ARTEMIS_HOST:artemis}
    port: ${ARTEMIS_PORT:61616}
    user: ${ARTEMIS_USER:artemis}
    password: ${ARTEMIS_PASSWORD:artemis}

  # WebSocket
  websocket:
    enabled: true
    path: /ws

  # Security
  security:
    oauth2:
      client:
        registration:
          github:
            client-id: ${GITHUB_CLIENT_ID}
            client-secret: ${GITHUB_CLIENT_SECRET}
            scope: read:user,read:email,repo
        provider:
          github:
            authorization-uri: https://github.com/login/oauth/authorize
            token-uri: https://github.com/login/oauth/access_token
            user-info-uri: https://api.github.com/user
            user-name-attribute: login

  # Jackson
  jackson:
    default-property-inclusion: non_null
    serialization:
      write-dates-as-timestamps: false

  # File upload
  servlet:
    multipart:
      max-file-size: 10MB
      max-request-size: 10MB

# Logging
logging:
  level:
    root: INFO
    com.pullwise: INFO
    org.springframework: WARN
    org.hibernate.SQL: WARN
    org.hibernate.type.descriptor.sql.BasicBinder: WARN
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
  file:
    name: /logs/pullwise-api.log
    max-size: 100MB
    max-history: 30

# Actuator
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
      base-path: /actuator
  endpoint:
    health:
      show-details: when-authorized
      show-components: always
      probes:
        enabled: true
  health:
    livenessstate:
      enabled: true
    readinessstate:
      enabled: true
  metrics:
    export:
      prometheus:
        enabled: true
    tags:
      application: pullwise-api
    distribution:
      percentiles-histogram:
        http.server.requests: true

# Application
pullwise:
  security:
    jwt-secret: ${JWT_SECRET}
    jwt-expiration: ${JWT_EXPIRATION:86400000}
    cors:
      allowed-origins: ${CORS_ORIGINS:https://pullwise.ai,https://www.pullwise.ai}
      allowed-methods: GET,POST,PUT,DELETE,PATCH,OPTIONS
      allowed-headers: "*"
      allow-credentials: true
      max-age: 3600

  github:
    api-url: https://api.github.com
    webhook-secret: ${GITHUB_WEBHOOK_SECRET:}
    auto-review:
      enabled: true

  bitbucket:
    api-url: https://api.bitbucket.org
    webhook-secret: ${BITBUCKET_WEBHOOK_SECRET:}

  sonarqube:
    enabled: ${SONARQUBE_ENABLED:false}
    url: ${SONARQUBE_URL:}
    token: ${SONARQUBE_TOKEN:}

  llm:
    provider: ${LLM_PROVIDER:openrouter}
    openrouter:
      api-key: ${OPENROUTER_API_KEY}
      model: ${LLM_MODEL:anthropic/claude-3.5-sonnet}
      max-tokens: 4096
      temperature: 0.3
    ollama:
      base-url: ${OLLAMA_BASE_URL:http://localhost:11434}
      model: ${OLLAMA_MODEL:codellama:7b}

  stripe:
    api-key: ${STRIPE_API_KEY}
      webhook-secret: ${STRIPE_WEBHOOK_SECRET:}
      success-url: https://pullwise.ai/billing/success
      cancel-url: https://pullwise.ai/billing/canceled

  rag:
    enabled: ${RAG_ENABLED:false}
    chunk-size: 512
    chunk-overlap: 50
    max-results: 5

  analysis:
    max-files-per-review: 50
    max-lines-per-file: 2000
    timeout-seconds: 300
