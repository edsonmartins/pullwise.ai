import{j as e,S as f,L as K,b as c,G as x,T as j,y as P,B as E,l as y,m as h,h as M}from"./mantine-CZuIZRc1.js";import{r as G}from"./react-core-odM0sU5y.js";import{u as Q}from"./queries-6Rqy06Fp.js";import{a as $}from"./api-DKMFut8u.js";import{u as q}from"./v2-store-DFm9FS0q.js";import{p as N,C as z,D as k,I as H,a as U,E as X,F as Y,G as V}from"./icons-D07X1pjv.js";import{R as b,A as W,C as B,X as A,Y as D,T as v,L as _,a as w,P as J,b as Z,c as m,B as ee,d as se}from"./charts-BUPZVE1m.js";import"./index-Dc4pxRQV.js";import"./routing-CXNmw2WA.js";const r={critical:"#ef4444",high:"#f97316",medium:"#eab308",low:"#22c55e",info:"#3b82f6",purple:"#a855f7",cyan:"#06b6d4"};function xe(){const{setAnalyticsData:t,selectedTimeRange:l,setSelectedTimeRange:o}=q(),{data:i,isLoading:n,refetch:g}=Q({queryKey:["analytics",l],queryFn:()=>$.getOverview(l)});G.useEffect(()=>{i&&t(i)},[i,t]);const L=[{value:"7d",label:"7 dias"},{value:"30d",label:"30 dias"},{value:"90d",label:"90 dias"},{value:"365d",label:"1 ano"}];if(n)return e.jsxs(f,{align:"center",py:"xl",children:[e.jsx(K,{size:"lg"}),e.jsx(c,{mt:"md",c:"dimmed",children:"Carregando analytics..."})]});const a=i==null?void 0:i.overview,d=(i==null?void 0:i.trends)||[],R=(i==null?void 0:i.topIssues)||[],T=(i==null?void 0:i.teamStats)||[],F=R.reduce((s,u)=>{const S=u.severity;return s[S]=(s[S]||0)+u.count,s},{}),O=Object.entries(F).map(([s,u])=>({name:s,value:u}));return e.jsxs(f,{gap:"xl",children:[e.jsxs(x,{justify:"space-between",children:[e.jsxs("div",{children:[e.jsx(j,{order:2,children:"Analytics Dashboard"}),e.jsx(c,{c:"dimmed",children:"Métricas e insights dos seus code reviews"})]}),e.jsxs(x,{children:[e.jsx(P,{value:l,onChange:s=>o(s||"30d"),data:L,w:120}),e.jsx(E,{leftSection:e.jsx(N,{size:16}),onClick:()=>g(),variant:"light",children:"Atualizar"})]})]}),e.jsxs(y,{cols:{base:1,sm:2,md:4},children:[e.jsx(p,{title:"Total Reviews",value:(a==null?void 0:a.totalReviews)||0,icon:e.jsx(z,{size:20}),color:"cyan",trend:d.length>1?C(d,"reviews"):void 0}),e.jsx(p,{title:"Issues Encontrados",value:(a==null?void 0:a.totalIssues)||0,icon:e.jsx(k,{size:20}),color:"purple",trend:d.length>1?C(d,"issues"):void 0}),e.jsx(p,{title:"Críticos",value:(a==null?void 0:a.criticalIssues)||0,icon:e.jsx(H,{size:20}),color:"critical",trend:d.length>1?C(d,"critical"):void 0}),e.jsx(p,{title:"Taxa de Auto-Fix",value:`${Math.round(((a==null?void 0:a.autoFixRate)||0)*100)}%`,icon:e.jsx(U,{size:20}),color:"info"})]}),e.jsxs(y,{cols:{base:1,md:2},children:[e.jsxs(h,{padding:"lg",radius:"md",withBorder:!0,h:400,children:[e.jsx(j,{order:4,mb:"md",children:"Tendência de Reviews e Issues"}),e.jsx(b,{width:"100%",height:300,children:e.jsxs(W,{data:d,children:[e.jsx(B,{strokeDasharray:"3 3"}),e.jsx(A,{dataKey:"date",tickFormatter:s=>new Date(s).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"})}),e.jsx(D,{}),e.jsx(v,{contentStyle:{backgroundColor:"var(--mantine-color-body)",borderRadius:"8px",border:"1px solid var(--mantine-color-border)"},labelFormatter:s=>String(s)}),e.jsx(_,{}),e.jsx(w,{type:"monotone",dataKey:"reviews",stackId:"1",stroke:r.cyan,fill:r.cyan,name:"Reviews",fillOpacity:.6}),e.jsx(w,{type:"monotone",dataKey:"issues",stackId:"2",stroke:r.purple,fill:r.purple,name:"Issues",fillOpacity:.6}),e.jsx(w,{type:"monotone",dataKey:"critical",stackId:"2",stroke:r.critical,fill:r.critical,name:"Críticos",fillOpacity:.6})]})})]}),e.jsxs(h,{padding:"lg",radius:"md",withBorder:!0,h:400,children:[e.jsx(j,{order:4,mb:"md",children:"Distribuição por Severidade"}),e.jsx(b,{width:"100%",height:300,children:e.jsxs(J,{children:[e.jsxs(Z,{data:O,cx:"50%",cy:"50%",labelLine:!1,label:({name:s,percent:u})=>`${s}: ${(u*100).toFixed(0)}%`,dataKey:"value",children:[e.jsx(m,{fill:r.critical,name:"CRITICAL"}),e.jsx(m,{fill:r.high,name:"HIGH"}),e.jsx(m,{fill:r.medium,name:"MEDIUM"}),e.jsx(m,{fill:r.low,name:"LOW"}),e.jsx(m,{fill:r.info,name:"INFO"})]}),e.jsx(v,{})]})})]})]}),e.jsxs(h,{padding:"lg",radius:"md",withBorder:!0,children:[e.jsx(j,{order:4,mb:"md",children:"Top Issues por Tipo"}),e.jsx(b,{width:"100%",height:300,children:e.jsxs(ee,{data:R,layout:"vertical",children:[e.jsx(B,{strokeDasharray:"3 3"}),e.jsx(A,{type:"number"}),e.jsx(D,{dataKey:"type",type:"category",width:100,tickFormatter:s=>s.replace("_"," ")}),e.jsx(v,{contentStyle:{backgroundColor:"var(--mantine-color-body)",borderRadius:"8px",border:"1px solid var(--mantine-color-border)"},formatter:s=>[s,"count"]}),e.jsx(se,{dataKey:"count",fill:r.purple})]})})]}),e.jsxs(h,{padding:"lg",radius:"md",withBorder:!0,children:[e.jsx(j,{order:4,mb:"md",children:"Métricas por Time"}),T.length===0?e.jsx(c,{c:"dimmed",ta:"center",py:"xl",children:"Nenhum dado de time disponível"}):e.jsx(y,{cols:{base:1,sm:2,md:3},children:T.map(s=>e.jsxs(h,{padding:"md",radius:"sm",withBorder:!0,children:[e.jsxs(x,{justify:"space-between",mb:"xs",children:[e.jsx(c,{fw:600,children:s.teamName}),e.jsxs(M,{color:s.avgQuality>=80?"green":s.avgQuality>=60?"yellow":"red",children:[Math.round(s.avgQuality),"% qualidade"]})]}),e.jsxs(f,{gap:4,children:[e.jsx(I,{label:"Reviews",value:s.reviews,icon:e.jsx(z,{size:14})}),e.jsx(I,{label:"Issues",value:s.issues,icon:e.jsx(k,{size:14})}),e.jsx(I,{label:"Tempo Médio",value:`${Math.round(s.avgReviewTime)}s`,icon:e.jsx(X,{size:14})})]})]},s.teamId))})]})]})}function p({title:t,value:l,icon:o,color:i,trend:n}){const g={critical:"#ef4444",high:"#f97316",medium:"#eab308",low:"#22c55e",info:"#3b82f6",cyan:"#06b6d4",purple:"#a855f7"};return e.jsxs(h,{padding:"lg",radius:"md",withBorder:!0,children:[e.jsxs(x,{justify:"space-between",mb:"xs",children:[e.jsx(c,{tt:"uppercase",size:"xs",fw:700,c:"dimmed",children:t}),e.jsx("div",{style:{color:g[i]},children:o})]}),e.jsxs(x,{align:"flex-end",children:[e.jsx(c,{fz:"xl",fw:700,children:l}),n&&e.jsxs(M,{color:n.isPositive?"green":"red",variant:"light",size:"xs",leftSection:n.isPositive?e.jsx(Y,{size:12}):e.jsx(V,{size:12}),children:[Math.abs(n.value),"%"]})]})]})}function I({label:t,value:l,icon:o}){return e.jsxs(x,{justify:"space-between",children:[e.jsxs(x,{gap:4,c:"dimmed",style:{fontSize:"0.875rem"},children:[o,e.jsx("span",{children:t})]}),e.jsx(c,{fw:600,children:l})]})}function C(t,l){if(t.length<2)return;const o=t[t.length-1][l],i=t[0][l];if(i===0)return;const n=(o-i)/i*100;return{value:Math.round(n),isPositive:n>=0}}export{xe as AnalyticsDashboardPage};
