import{j as e,S as w,G as t,T as J,b as o,B as M,l as ge,m as E,Q as he,y as P,k as xe,E as f,s as me,w as X,z as ae,R as Z,g as fe,h as I,V as je,K as pe,t as ve}from"./mantine-CZuIZRc1.js";import{r as n}from"./react-core-odM0sU5y.js";import{a as ye,u as ee,b as T}from"./queries-6Rqy06Fp.js";import{p as j}from"./api-DKMFut8u.js";import{u as be}from"./v2-store-DFm9FS0q.js";import{p as Ce,V as le,S as se,a as Se,W as ne,M as Ie,X as Te,Y as we,C as Me,i as ze,v as Pe}from"./icons-D07X1pjv.js";import"./index-Dc4pxRQV.js";import"./routing-CXNmw2WA.js";import"./charts-BUPZVE1m.js";const F=[{value:"all",label:"Todos"},{value:"SAST",label:"SAST"},{value:"LINTER",label:"Linter"},{value:"SECURITY",label:"Segurança"},{value:"PERFORMANCE",label:"Performance"},{value:"CUSTOM_LLM",label:"LLM Customizado"},{value:"INTEGRATION",label:"Integração"}],Le=[{value:"all",label:"Todos os Tipos"},{value:"java",label:"Java"},{value:"typescript",label:"TypeScript"},{value:"python",label:"Python"}],Ee=[{value:"popular",label:"Mais Popular"},{value:"recent",label:"Mais Recente"},{value:"name",label:"Nome (A-Z)"},{value:"rating",label:"Avaliação"}];function Be(){var _,W,Y,$;const l=ye(),{plugins:i,setPlugins:h,installedPlugins:u,setInstalledPlugins:p}=be(),[x,y]=n.useState(""),[d,m]=n.useState("all"),[c,ie]=n.useState("all"),[R,te]=n.useState("popular"),[r,re]=n.useState(null),[oe,z]=n.useState(!1),[v,b]=n.useState({}),{data:k=[]}=ee({queryKey:["plugins"],queryFn:()=>j.list()});n.useEffect(()=>{if(k.length>0){const a=k.map(s=>({...s,downloads:Math.floor(Math.random()*5e4),rating:3+Math.random()*2,ratingCount:Math.floor(Math.random()*500),lastUpdated:new Date(Date.now()-Math.random()*90*24*60*60*1e3).toISOString(),verified:Math.random()>.7,featured:Math.random()>.8,tags:["code-quality","security","ai"].slice(0,Math.floor(Math.random()*3)+1),category:F[Math.floor(Math.random()*(F.length-1))+1].value}));h(a)}},[k,h]);const{data:O=[]}=ee({queryKey:["plugins","installed"],queryFn:()=>j.getInstalled()});n.useEffect(()=>{O.length>0&&p(O.map(a=>a.id))},[O,p]);const C=T({mutationFn:a=>j.install(a),onSuccess:()=>{l.invalidateQueries({queryKey:["plugins"]}),l.invalidateQueries({queryKey:["plugins","installed"]})}}),S=T({mutationFn:a=>j.uninstall(a),onSuccess:()=>{l.invalidateQueries({queryKey:["plugins"]}),l.invalidateQueries({queryKey:["plugins","installed"]})}}),K=T({mutationFn:a=>j.enable(a),onSuccess:()=>{l.invalidateQueries({queryKey:["plugins"]}),l.invalidateQueries({queryKey:["plugins","installed"]})}}),G=T({mutationFn:a=>j.disable(a),onSuccess:()=>{l.invalidateQueries({queryKey:["plugins"]}),l.invalidateQueries({queryKey:["plugins","installed"]})}}),q=T({mutationFn:({pluginId:a,config:s})=>j.updateConfig(a,s),onSuccess:()=>{z(!1),l.invalidateQueries({queryKey:["plugins"]})}}),A=n.useMemo(()=>{let a=i;if(x){const s=x.toLowerCase();a=a.filter(g=>{var H;return g.name.toLowerCase().includes(s)||g.description.toLowerCase().includes(s)||g.author.toLowerCase().includes(s)||((H=g.tags)==null?void 0:H.some(ue=>ue.toLowerCase().includes(s)))})}return d!=="all"&&(a=a.filter(s=>s.category===d||s.type===d)),c!=="all"&&(a=a.filter(s=>s.supportedLanguages.includes(c))),a=[...a].sort((s,g)=>{switch(R){case"popular":return(g.downloads||0)-(s.downloads||0);case"recent":return new Date(g.lastUpdated||0).getTime()-new Date(s.lastUpdated||0).getTime();case"name":return s.name.localeCompare(g.name);case"rating":return(g.rating||0)-(s.rating||0);default:return 0}}),a},[i,x,d,c,R]),V=A.filter(a=>a.featured),de=A.filter(a=>!a.featured),N=n.useCallback(a=>{C.mutate(a)},[C]),U=n.useCallback(a=>{S.mutate(a)},[S]),Q=n.useCallback(a=>{a.enabled?G.mutate(a.id):K.mutate(a.id)},[K,G]),D=n.useCallback(a=>{re(a),b(a.config||{}),z(!0)},[]),ce=n.useCallback(()=>{r&&q.mutate({pluginId:r.id,config:v})},[r,v,q]);return e.jsxs(w,{gap:"md",children:[e.jsxs(t,{justify:"space-between",children:[e.jsxs("div",{children:[e.jsx(J,{order:2,children:"Plugin Marketplace"}),e.jsx(o,{c:"dimmed",children:"Descubra e gerencie plugins para estender o Pullwise"})]}),e.jsx(M,{leftSection:e.jsx(Ce,{size:16}),onClick:()=>l.invalidateQueries({queryKey:["plugins"]}),variant:"light",children:"Atualizar"})]}),e.jsxs(ge,{cols:{base:2,md:4},children:[e.jsx(L,{label:"Total Disponível",value:i.length,icon:e.jsx(le,{size:20})}),e.jsx(L,{label:"Instalados",value:u.length,icon:e.jsx(se,{size:20}),color:"green"}),e.jsx(L,{label:"Ativos",value:i.filter(a=>a.enabled).length,icon:e.jsx(Se,{size:20}),color:"blue"}),e.jsx(L,{label:"Verificados",value:i.filter(a=>a.verified).length,icon:e.jsx(ne,{size:20}),color:"yellow"})]}),e.jsx(E,{padding:"sm",withBorder:!0,children:e.jsxs(t,{children:[e.jsx(he,{placeholder:"Buscar plugins...",leftSection:e.jsx(Ie,{size:16}),value:x,onChange:a=>y(a.currentTarget.value),style:{flex:1},miw:250}),e.jsx(P,{value:d,onChange:a=>m(a||"all"),data:F,leftSection:e.jsx(Te,{size:16})}),e.jsx(P,{value:c,onChange:a=>ie(a||"all"),data:Le}),e.jsx(P,{value:R,onChange:a=>te(a||"popular"),data:Ee,leftSection:e.jsx(we,{size:16})})]})}),e.jsx(xe,{mah:800,children:e.jsxs(f,{defaultValue:"installed",children:[e.jsxs(f.List,{children:[e.jsxs(f.Tab,{value:"installed",children:["Instalados (",u.length,")"]}),e.jsxs(f.Tab,{value:"available",children:["Disponíveis (",A.length,")"]}),e.jsxs(f.Tab,{value:"featured",children:["Destaques (",V.length,")"]})]}),e.jsx(f.Panel,{value:"installed",pt:"md",children:e.jsx(B,{plugins:i.filter(a=>u.includes(a.id)),isInstalledTab:!0,onInstall:N,onUninstall:U,onToggleEnable:Q,onOpenConfig:D,isInstalling:C.isPending,isUninstalling:S.isPending})}),e.jsx(f.Panel,{value:"available",pt:"md",children:e.jsx(B,{plugins:de,onInstall:N,onUninstall:U,onToggleEnable:Q,onOpenConfig:D,isInstalling:C.isPending,isUninstalling:S.isPending})}),e.jsx(f.Panel,{value:"featured",pt:"md",children:e.jsx(B,{plugins:V,onInstall:N,onUninstall:U,onToggleEnable:Q,onOpenConfig:D,isInstalling:C.isPending,isUninstalling:S.isPending})})]})}),e.jsx(me,{opened:oe,onClose:()=>z(!1),title:e.jsxs(J,{order:4,children:["Configurar ",r==null?void 0:r.name]}),size:"md",children:r&&e.jsxs(w,{gap:"md",children:[e.jsx(o,{size:"sm",c:"dimmed",children:"Configure as opções do plugin abaixo."}),e.jsxs(w,{gap:"sm",children:[e.jsx(X,{label:"Nome da Configuração",placeholder:"Minha configuração",defaultValue:((_=r.config)==null?void 0:_.name)||"",onChange:a=>b({...v,name:a.currentTarget.value})}),e.jsx(ae,{label:"Habilitar notificações",description:"Receba notificações quando este plugin encontrar issues",defaultChecked:!!((W=r.config)!=null&&W.notifications),onChange:a=>b({...v,notifications:a.currentTarget.checked})}),e.jsx(X,{label:"Limite de recursos",placeholder:"1024",description:"Limite máximo de memória (MB)",type:"number",defaultValue:((Y=r.config)==null?void 0:Y.memoryLimit)||1024,onChange:a=>b({...v,memoryLimit:parseInt(a.currentTarget.value)||1024})}),e.jsx(P,{label:"Nível de log",data:[{value:"ERROR",label:"Erro"},{value:"WARN",label:"Aviso"},{value:"INFO",label:"Info"},{value:"DEBUG",label:"Debug"}],defaultValue:(($=r.config)==null?void 0:$.logLevel)||"INFO",onChange:a=>b({...v,logLevel:a})})]}),e.jsxs(t,{justify:"flex-end",mt:"md",children:[e.jsx(M,{variant:"light",onClick:()=>z(!1),children:"Cancelar"}),e.jsx(M,{onClick:ce,loading:q.isPending,children:"Salvar Configuração"})]})]})})]})}function L({label:l,value:i,icon:h,color:u="blue"}){return e.jsx(E,{padding:"md",withBorder:!0,children:e.jsxs(t,{children:[e.jsx("div",{style:{color:`var(--mantine-color-${u}-filled)`},children:h}),e.jsxs("div",{children:[e.jsx(o,{size:"xs",c:"dimmed",children:l}),e.jsx(o,{fz:"xl",fw:700,children:i})]})]})})}function B({plugins:l,isInstalledTab:i=!1,onInstall:h,onUninstall:u,onToggleEnable:p,onOpenConfig:x,isInstalling:y,isUninstalling:d}){return l.length===0?e.jsx(E,{padding:"xl",withBorder:!0,children:e.jsxs(w,{align:"center",py:"xl",children:[e.jsx(le,{size:48,style:{color:"var(--mantine-color-dimmed)"}}),e.jsx(o,{c:"dimmed",children:i?"Nenhum plugin instalado":"Nenhum plugin encontrado"})]})}):e.jsx(Z,{children:l.map(m=>e.jsx(Z.Col,{span:{base:12,sm:6,lg:4},children:e.jsx(Re,{plugin:m,onInstall:h,onUninstall:u,onToggleEnable:p,onOpenConfig:x,isInstalling:y,isUninstalling:d})},m.id))})}function Re({plugin:l,onInstall:i,onUninstall:h,onToggleEnable:u,onOpenConfig:p,isInstalling:x,isUninstalling:y}){const d=l.installed,m={SAST:"blue",SECURITY:"red",PERFORMANCE:"yellow",CUSTOM_LLM:"grape",INTEGRATION:"green",LINTER:"cyan"}[l.category||l.type]||"gray";return e.jsx(E,{padding:"md",withBorder:!0,h:"100%",style:{display:"flex",flexDirection:"column"},children:e.jsxs(w,{gap:"sm",style:{flex:1},children:[e.jsxs(t,{justify:"space-between",align:"flex-start",children:[e.jsxs(t,{gap:"sm",children:[e.jsx("div",{style:{width:48,height:48,borderRadius:"8px",background:`linear-gradient(135deg, var(--mantine-color-${m}-4), var(--mantine-color-${m}-7))`,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Me,{size:24,style:{color:"white"}})}),e.jsxs("div",{children:[e.jsxs(t,{gap:4,children:[e.jsx(o,{fw:600,children:l.name}),l.verified&&e.jsx(fe,{label:"Plugin verificado",children:e.jsx(ne,{size:14,color:"var(--mantine-color-yellow-5)",fill:"currentColor"})})]}),e.jsxs(o,{size:"xs",c:"dimmed",children:["por ",l.author]})]})]}),l.featured&&e.jsx(I,{color:"yellow",variant:"filled",size:"xs",children:"Destaque"})]}),e.jsxs(t,{gap:4,children:[e.jsx(I,{size:"xs",color:m,variant:"light",children:l.category||l.type}),e.jsxs(I,{size:"xs",variant:"outline",children:["v",l.version]}),l.supportedLanguages.slice(0,2).map(c=>e.jsx(I,{size:"xs",variant:"dot",children:c},c))]}),e.jsx(o,{size:"sm",lineClamp:2,children:l.description}),l.tags&&l.tags.length>0&&e.jsx(t,{gap:4,children:l.tags.map(c=>e.jsx(I,{size:"xs",variant:"light",color:"gray",children:c},c))}),e.jsxs(t,{gap:"md",children:[l.rating&&e.jsxs(t,{gap:4,children:[e.jsx(je,{value:l.rating,fractions:2,readOnly:!0,size:"xs"}),e.jsxs(o,{size:"xs",c:"dimmed",children:["(",l.ratingCount,")"]})]}),l.downloads&&e.jsxs(o,{size:"xs",c:"dimmed",children:[l.downloads>1e3?`${(l.downloads/1e3).toFixed(1)}k`:l.downloads," downloads"]})]}),e.jsx(pe,{}),e.jsxs(o,{size:"xs",c:"dimmed",children:["Suporta: ",l.supportedLanguages.join(", ")]}),e.jsx(t,{gap:4,children:d?e.jsxs(e.Fragment,{children:[e.jsx(ae,{size:"sm",label:l.enabled?"Ativo":"Inativo",checked:l.enabled,onChange:()=>u(l),disabled:!l.enabled&&!d}),e.jsx(ve,{variant:"light",color:"blue",onClick:()=>p(l),disabled:!l.enabled,children:e.jsx(ze,{size:16})}),e.jsx(M,{size:"sm",variant:"light",color:"red",leftSection:e.jsx(Pe,{size:14}),onClick:()=>h(l.id),loading:y,children:"Remover"})]}):e.jsx(M,{size:"sm",fullWidth:!0,leftSection:e.jsx(se,{size:14}),onClick:()=>i(l.id),loading:x,children:"Instalar"})})]})})}export{Be as PluginMarketplacePage};
